<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width">
<title>
How to write Raku's trans routine/operator in Go
</title>
<meta name=description content="Writings of Siavash Askari Nasr">
<link rel=stylesheet href=https://www.ciavash.name/sass/main.min.e994a45c9a4760edc7d2cfc8b10b31bacb2ffe0744639de74214d73bf5264029.css>
<link rel=alternate type=application/rss+xml href=https://www.ciavash.name/blog/atom.xml title=CIAvash::Blog>
</head>
<body>
<div class=wrapper>
<header class=page-header>
<h1 class=page-header-title><a href=/blog/>CIAvash::Blog</a></h1>
<span class=page-header-subtitle>Writings of Siavash Askari Nasr</span>
<ul class="s-links list-unstyled list-inline">
<li>
<a href=/ title=Home rel=me>
<img alt=Home src=/assets/img/icon/fa-home.svg>
</a>
</li>
<li>
<a href=/blog/ title=Blog>
<img alt=Blog src=/assets/img/icon/fa-blog.svg>
</a>
</li>
<li>
<a href=/blog/atom.xml title=Feed>
<img alt=Feed src=/assets/img/icon/fa-rss.svg>
</a>
</li>
<li>
<a href=https://mastodon.social/@CIAvash title=Mastodon rel=me>
<img alt=Mastodon src=/assets/img/icon/fa-mastodon.svg>
</a>
</li>
<li>
<a href=https://twitter.com/CIAvash title=Twitter rel=me>
<img alt=Twitter src=/assets/img/icon/fa-twitter.svg>
</a>
</li>
<li>
<a href=https://github.com/CIAvash title=Github rel=me>
<img alt=Github src=/assets/img/icon/fa-github.svg>
</a>
</li>
<li>
<a href=https://gitlab.com/u/CIAvash title=Gitlab rel=me>
<img alt=Gitlab src=/assets/img/icon/fa-gitlab.svg>
</a>
</li>
<li>
<a href=https://www.artstation.com/CIAvash title=Artstation rel=me>
<img alt=Artstation src=/assets/img/icon/fa-artstation.svg>
</a>
</li>
</ul>
</header>
<main>
<article class=article>
<header>
<h2 class=article-title>How to write Raku's trans routine/operator in Go</h2>
<p class=article-meta>
<span class=article-author>By CIAvash ‚Ä¢ </span>
<time datetime=2022-02-13>Feb 13, 2022</time>
‚Ä¢ Category:
<a href=https://www.ciavash.name/categories/Raku/>Raku</a>
,
<a href=https://www.ciavash.name/categories/Go/>Go</a>
,
<a href=https://www.ciavash.name/categories/Programming/>Programming</a>
‚Ä¢ Tag:
<a href=https://www.ciavash.name/tags/Raku/>Raku</a>
,
<a href=https://www.ciavash.name/tags/Go/>Go</a>
,
<a href=https://www.ciavash.name/tags/Golang/>Golang</a>
,
<a href=https://www.ciavash.name/tags/Translate/>Translate</a>
,
<a href=https://www.ciavash.name/tags/Transliteration/>Transliteration</a>
,
<a href=https://www.ciavash.name/tags/Web-Scraping/>Web Scraping</a>
,
<a href=https://www.ciavash.name/tags/CSS-Selectors/>CSS Selectors</a>
</p>
</header>
<div class=article-content>
<p>I was looking for a way to transliterate(translate) English numbers to Persian numbers in Go.
Such functionality is usually found in programming languages, but I wasn't expecting too much from Go.</p>
<p>It's very easy to do in <a href=https://www.raku-lang.ir/en>Raku</a>:</p>
<div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-raku data-lang=raku><span style=color:#ef8383>say</span> <span style=color:#d19a66>567</span><span style=color:#c7bf54>.</span><span style=color:#ef8383>trans</span><span style=color:#c7bf54>:</span> &#39;<span style=color:#98c379>0</span>&#39;<span style=color:#c7bf54>..</span>&#39;<span style=color:#98c379>9</span>&#39; <span style=color:#c7bf54>=&gt;</span> &#39;<span style=color:#98c379>€∞</span>&#39;<span style=color:#c7bf54>..</span>&#39;<span style=color:#98c379>€π</span>&#39;
<span style=color:#c1abea>=output</span><span style=color:#7e97c3> €µ€∂€∑‚ê§
</span><span style=color:#7e97c3>
</span><span style=color:#7e97c3></span><span style=color:#ef8383>say</span> <span style=color:#c678dd>TR</span>/<span style=color:#d19a66>0</span><span style=color:#c7bf54>..</span><span style=color:#d19a66>9</span>/<span style=color:#63c381>€∞..€π</span>/ <span style=color:#c678dd>given</span> <span style=color:#d19a66>567</span>
<span style=color:#c1abea>=output</span><span style=color:#7e97c3> €µ€∂€∑‚ê§
</span></code></pre></div><p>For Go I found <a href=https://pkg.go.dev/github.com/huandu/xstrings>xstrings</a> module which has a
<a href=https://pkg.go.dev/github.com/huandu/xstrings#Translate><code>Translate</code></a> function. But the solution I came up with was using
<a href=https://pkg.go.dev/strings#Replacer><code>NewReplacer</code></a> function from Go's internal <a href=https://pkg.go.dev/strings>strings</a>
module:</p>
<div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#c678dd>package</span> <span style=color:#c1abea>main</span>

<span style=color:#c678dd>import</span> (
	<span style=color:#98c379>&#34;fmt&#34;</span>
	<span style=color:#98c379>&#34;strings&#34;</span>
)

<span style=color:#c678dd>func</span> <span style=color:#00b1f7>main</span>() {
	<span style=color:#c1abea>fmt</span>.<span style=color:#00b1f7>Println</span>(<span style=color:#c1abea>strings</span>.<span style=color:#00b1f7>NewReplacer</span>(<span style=color:#98c379>`0`</span>, <span style=color:#98c379>`€∞`</span>, <span style=color:#98c379>`1`</span>, <span style=color:#98c379>`€±`</span>, <span style=color:#98c379>`2`</span>, <span style=color:#98c379>`€≤`</span>, <span style=color:#98c379>`3`</span>, <span style=color:#98c379>`€≥`</span>, <span style=color:#98c379>`4`</span>, <span style=color:#98c379>`€¥`</span>, <span style=color:#98c379>`5`</span>, <span style=color:#98c379>`€µ`</span>, <span style=color:#98c379>`6`</span>, <span style=color:#98c379>`€∂`</span>, <span style=color:#98c379>`7`</span>, <span style=color:#98c379>`€∑`</span>, <span style=color:#98c379>`8`</span>, <span style=color:#98c379>`€∏`</span>, <span style=color:#98c379>`9`</span>, <span style=color:#98c379>`€π`</span>).<span style=color:#00b1f7>Replace</span>(<span style=color:#98c379>`567`</span>))
}
</code></pre></div><p><a href=https://go.dev/play/p/-o0OUvoLKsm>Go playground link</a></p>
<p>This could be easier to write if Go had a <code>zip</code> function, so you could zip two slices (or ranges if Go had a range
operator) and then use the <code>...</code> unpack operator. Or <code>Replacer</code> could have a method that took two slices or better two
ranges(that is, if Go had it), specially now that Generics are coming to Go.</p>
<p>Unrelated to the title of this blog post, I was also looking for a module to parse HTML documents using CSS selectors;
my search led me to <a href=https://pkg.go.dev/github.com/PuerkitoBio/goquery>goquery</a>. Which was what I wanted, but I
couldn't find an easy way to get the whitespace-trimmed text content of HTML elements; there was a <code>Text</code> function, but
that contained everything. It seems it's not just the way of thinking of the Go language that makes me want more, but
also some Go modules. So I ended up writing a recursive function to trim whitespace using <code>strings.TrimSpace</code> and join texts.</p>
<p>This is how I would do it in Raku, using <a href=https://github.com/zostay/raku-DOM-Tiny>DOM::Tiny</a> (also containing the previous code):</p>
<div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-raku data-lang=raku><span style=color:#ef8383>put</span> <span style=color:#dcaeea>$dom</span><span style=color:#c7bf54>.</span><span style=color:#ef8383>find</span>(&#39;<span style=color:#98c379>.my-element &gt; div</span>&#39;)<span style=color:#c7bf54>.</span><span style=color:#ef8383>map</span>(<span style=color:#c7bf54>*.</span><span style=color:#00b1f7>all-text</span>(:<span style=color:#98c379>trim</span>))<span style=color:#c7bf54>.</span><span style=color:#ef8383>join</span>(&#34;<span style=color:#d26464;font-weight:700>\n</span>&#34;)<span style=color:#c7bf54>.</span><span style=color:#ef8383>trans</span><span style=color:#c7bf54>:</span> &#39;<span style=color:#98c379>0</span>&#39;<span style=color:#c7bf54>..</span>&#39;<span style=color:#98c379>9</span>&#39; <span style=color:#c7bf54>=&gt;</span> &#39;<span style=color:#98c379>€∞</span>&#39;<span style=color:#c7bf54>..</span>&#39;<span style=color:#98c379>€π</span>&#39;;
</code></pre></div><p>And this is my Go solution(maybe there are better ways to do it, that I'm not aware of, or even better way to write my code):</p>
<div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8a93a5;font-style:italic>// ........
</span><span style=color:#8a93a5;font-style:italic></span>	<span style=color:#c1abea>text</span> <span style=color:#c7bf54>:=</span> <span style=color:#c1abea>strings</span>.<span style=color:#00b1f7>Join</span>(<span style=color:#c1abea>doc</span>.<span style=color:#00b1f7>Find</span>(<span style=color:#98c379>`.my-element &gt; div`</span>).<span style=color:#00b1f7>Map</span>(<span style=color:#c1abea>getText</span>), <span style=color:#98c379>&#34;\n&#34;</span>)

	<span style=color:#c1abea>text</span> = <span style=color:#c1abea>strings</span>.<span style=color:#00b1f7>NewReplacer</span>(<span style=color:#98c379>`0`</span>, <span style=color:#98c379>`€∞`</span>, <span style=color:#98c379>`1`</span>, <span style=color:#98c379>`€±`</span>, <span style=color:#98c379>`2`</span>, <span style=color:#98c379>`€≤`</span>, <span style=color:#98c379>`3`</span>, <span style=color:#98c379>`€≥`</span>, <span style=color:#98c379>`4`</span>, <span style=color:#98c379>`€¥`</span>, <span style=color:#98c379>`5`</span>, <span style=color:#98c379>`€µ`</span>, <span style=color:#98c379>`6`</span>, <span style=color:#98c379>`€∂`</span>, <span style=color:#98c379>`7`</span>, <span style=color:#98c379>`€∑`</span>, <span style=color:#98c379>`8`</span>, <span style=color:#98c379>`€∏`</span>, <span style=color:#98c379>`9`</span>, <span style=color:#98c379>`€π`</span>).<span style=color:#00b1f7>Replace</span>(<span style=color:#c1abea>text</span>)

	<span style=color:#c1abea>fmt</span>.<span style=color:#00b1f7>Println</span>(<span style=color:#c1abea>text</span>)
<span style=color:#8a93a5;font-style:italic>// ........
</span><span style=color:#8a93a5;font-style:italic></span>
<span style=color:#c678dd>func</span> <span style=color:#00b1f7>getText</span> (<span style=color:#c1abea>_</span> <span style=color:#ef8383>int</span>, <span style=color:#c1abea>s</span> <span style=color:#c7bf54>*</span><span style=color:#c1abea>goquery</span>.<span style=color:#c1abea>Selection</span>) <span style=color:#ef8383>string</span> {
	<span style=color:#c678dd>if</span> <span style=color:#c1abea>children</span> <span style=color:#c7bf54>:=</span> <span style=color:#c1abea>s</span>.<span style=color:#00b1f7>ChildrenFiltered</span>(<span style=color:#98c379>`:not(img)`</span>); <span style=color:#c1abea>children</span>.<span style=color:#00b1f7>Text</span>() <span style=color:#c7bf54>!=</span> <span style=color:#98c379>``</span> {
		<span style=color:#c678dd>return</span> <span style=color:#c1abea>strings</span>.<span style=color:#00b1f7>Join</span>(<span style=color:#c1abea>children</span>.<span style=color:#00b1f7>Map</span>(<span style=color:#c1abea>getText</span>), <span style=color:#98c379>` `</span>)
	} <span style=color:#c678dd>else</span> {
		<span style=color:#c678dd>return</span> <span style=color:#c1abea>strings</span>.<span style=color:#00b1f7>TrimSpace</span>(<span style=color:#c1abea>s</span>.<span style=color:#00b1f7>Text</span>())
	}
}
</code></pre></div><p>Another solution is using the <code>regexp</code> module to replace all whitespace:</p>
<div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#8a93a5;font-style:italic>// ........
</span><span style=color:#8a93a5;font-style:italic></span>	<span style=color:#c1abea>text</span> <span style=color:#c7bf54>:=</span> <span style=color:#c1abea>strings</span>.<span style=color:#00b1f7>Join</span>(<span style=color:#c1abea>doc</span>.<span style=color:#00b1f7>Find</span>(<span style=color:#98c379>`.my-element &gt; div`</span>).<span style=color:#00b1f7>Map</span>(<span style=color:#c678dd>func</span>(<span style=color:#c1abea>_</span> <span style=color:#ef8383>int</span>, <span style=color:#c1abea>s</span> <span style=color:#c7bf54>*</span><span style=color:#c1abea>goquery</span>.<span style=color:#c1abea>Selection</span>) <span style=color:#ef8383>string</span> {
		<span style=color:#c1abea>re</span> <span style=color:#c7bf54>:=</span> <span style=color:#c1abea>regexp</span>.<span style=color:#00b1f7>MustCompile</span>(<span style=color:#98c379>`\s+`</span>)
		<span style=color:#c678dd>return</span> <span style=color:#c1abea>re</span>.<span style=color:#00b1f7>ReplaceAllLiteralString</span>(<span style=color:#c1abea>s</span>.<span style=color:#00b1f7>Text</span>(), <span style=color:#98c379>` `</span>)
	}), <span style=color:#98c379>&#34;\n&#34;</span>)

	<span style=color:#c1abea>text</span> = <span style=color:#c1abea>strings</span>.<span style=color:#00b1f7>NewReplacer</span>(<span style=color:#98c379>`0`</span>, <span style=color:#98c379>`€∞`</span>, <span style=color:#98c379>`1`</span>, <span style=color:#98c379>`€±`</span>, <span style=color:#98c379>`2`</span>, <span style=color:#98c379>`€≤`</span>, <span style=color:#98c379>`3`</span>, <span style=color:#98c379>`€≥`</span>, <span style=color:#98c379>`4`</span>, <span style=color:#98c379>`€¥`</span>, <span style=color:#98c379>`5`</span>, <span style=color:#98c379>`€µ`</span>, <span style=color:#98c379>`6`</span>, <span style=color:#98c379>`€∂`</span>, <span style=color:#98c379>`7`</span>, <span style=color:#98c379>`€∑`</span>, <span style=color:#98c379>`8`</span>, <span style=color:#98c379>`€∏`</span>, <span style=color:#98c379>`9`</span>, <span style=color:#98c379>`€π`</span>).<span style=color:#00b1f7>Replace</span>(<span style=color:#c1abea>text</span>)

	<span style=color:#c1abea>fmt</span>.<span style=color:#00b1f7>Println</span>(<span style=color:#c1abea>text</span>)
<span style=color:#8a93a5;font-style:italic>// ........
</span></code></pre></div><p>What I get from Go is speed, so I won't complain too much üòÄ</p>
<p>And just for fun, I'm still seeing this when I visit <a href=https://pkg.go.dev>https://pkg.go.dev</a> :
<a href=/img/pkg.go.dev-blocked-for-Iran-by-Google.png>
<img src=/img/pkg.go.dev-blocked-for-Iran-by-Google.png alt="pkg.go.dev blocked for Iran by Google">
</a></p>
</div>
</article>
</main>
</div>
</body>
</html>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>CIAvash - Golang</title><link>https://www.ciavash.name/tags/Golang/</link><description>Recent content in Golang</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><managingEditor>CIAvash</managingEditor><webMaster>CIAvash</webMaster><lastBuildDate>Sun, 13 Feb 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://www.ciavash.name/tags/Golang/atom.xml" rel="self" type="application/rss+xml"/><item><title>How to write Raku's trans routine/operator in Go</title><link>https://www.ciavash.name/blog/2022/02/13/how-to-write-raku-trans-sub-operator-in-go/</link><pubDate>Sun, 13 Feb 2022 00:00:00 +0000</pubDate><author>CIAvash</author><guid>https://www.ciavash.name/blog/2022/02/13/how-to-write-raku-trans-sub-operator-in-go/</guid><description>&lt;p>I was looking for a way to transliterate(translate) English numbers to Persian numbers in Go.
Such functionality is usually found in programming languages, but I wasn't expecting too much from Go.&lt;/p>
&lt;p>It's very easy to do in &lt;a href="https://www.raku-lang.ir/en">Raku&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-raku" data-lang="raku">&lt;span style="color:#ef8383">say&lt;/span> &lt;span style="color:#d19a66">567&lt;/span>&lt;span style="color:#c7bf54">.&lt;/span>&lt;span style="color:#ef8383">trans&lt;/span>&lt;span style="color:#c7bf54">:&lt;/span> &amp;#39;&lt;span style="color:#98c379">0&lt;/span>&amp;#39;&lt;span style="color:#c7bf54">..&lt;/span>&amp;#39;&lt;span style="color:#98c379">9&lt;/span>&amp;#39; &lt;span style="color:#c7bf54">=&amp;gt;&lt;/span> &amp;#39;&lt;span style="color:#98c379">Û°&lt;/span>&amp;#39;&lt;span style="color:#c7bf54">..&lt;/span>&amp;#39;&lt;span style="color:#98c379">Û¹&lt;/span>&amp;#39;
&lt;span style="color:#c1abea">=output&lt;/span>&lt;span style="color:#7e97c3"> ÛµÛ¶Û·â¤
&lt;/span>&lt;span style="color:#7e97c3">
&lt;/span>&lt;span style="color:#7e97c3">&lt;/span>&lt;span style="color:#ef8383">say&lt;/span> &lt;span style="color:#c678dd">TR&lt;/span>/&lt;span style="color:#d19a66">0&lt;/span>&lt;span style="color:#c7bf54">..&lt;/span>&lt;span style="color:#d19a66">9&lt;/span>/&lt;span style="color:#63c381">Û°..Û¹&lt;/span>/ &lt;span style="color:#c678dd">given&lt;/span> &lt;span style="color:#d19a66">567&lt;/span>
&lt;span style="color:#c1abea">=output&lt;/span>&lt;span style="color:#7e97c3"> ÛµÛ¶Û·â¤
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For Go I found &lt;a href="https://pkg.go.dev/github.com/huandu/xstrings">xstrings&lt;/a> module which has a
&lt;a href="https://pkg.go.dev/github.com/huandu/xstrings#Translate">&lt;code>Translate&lt;/code>&lt;/a> function. But the solution I came up with was using
&lt;a href="https://pkg.go.dev/strings#Replacer">&lt;code>NewReplacer&lt;/code>&lt;/a> function from Go's internal &lt;a href="https://pkg.go.dev/strings">strings&lt;/a>
module:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#c678dd">package&lt;/span> &lt;span style="color:#c1abea">main&lt;/span>
&lt;span style="color:#c678dd">import&lt;/span> (
&lt;span style="color:#98c379">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span style="color:#98c379">&amp;#34;strings&amp;#34;&lt;/span>
)
&lt;span style="color:#c678dd">func&lt;/span> &lt;span style="color:#00b1f7">main&lt;/span>() {
&lt;span style="color:#c1abea">fmt&lt;/span>.&lt;span style="color:#00b1f7">Println&lt;/span>(&lt;span style="color:#c1abea">strings&lt;/span>.&lt;span style="color:#00b1f7">NewReplacer&lt;/span>(&lt;span style="color:#98c379">`0`&lt;/span>, &lt;span style="color:#98c379">`Û°`&lt;/span>, &lt;span style="color:#98c379">`1`&lt;/span>, &lt;span style="color:#98c379">`Û±`&lt;/span>, &lt;span style="color:#98c379">`2`&lt;/span>, &lt;span style="color:#98c379">`Û²`&lt;/span>, &lt;span style="color:#98c379">`3`&lt;/span>, &lt;span style="color:#98c379">`Û³`&lt;/span>, &lt;span style="color:#98c379">`4`&lt;/span>, &lt;span style="color:#98c379">`Û´`&lt;/span>, &lt;span style="color:#98c379">`5`&lt;/span>, &lt;span style="color:#98c379">`Ûµ`&lt;/span>, &lt;span style="color:#98c379">`6`&lt;/span>, &lt;span style="color:#98c379">`Û¶`&lt;/span>, &lt;span style="color:#98c379">`7`&lt;/span>, &lt;span style="color:#98c379">`Û·`&lt;/span>, &lt;span style="color:#98c379">`8`&lt;/span>, &lt;span style="color:#98c379">`Û¸`&lt;/span>, &lt;span style="color:#98c379">`9`&lt;/span>, &lt;span style="color:#98c379">`Û¹`&lt;/span>).&lt;span style="color:#00b1f7">Replace&lt;/span>(&lt;span style="color:#98c379">`567`&lt;/span>))
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://go.dev/play/p/-o0OUvoLKsm">Go playground link&lt;/a>&lt;/p>
&lt;p>This could be easier to write if Go had a &lt;code>zip&lt;/code> function, so you could zip two slices (or ranges if Go had a range
operator) and then use the &lt;code>...&lt;/code> unpack operator. Or &lt;code>Replacer&lt;/code> could have a method that took two slices or better two
ranges(that is, if Go had it), specially now that Generics are coming to Go.&lt;/p>
&lt;p>Unrelated to the title of this blog post, I was also looking for a module to parse HTML documents using CSS selectors;
my search led me to &lt;a href="https://pkg.go.dev/github.com/PuerkitoBio/goquery">goquery&lt;/a>. Which was what I wanted, but I
couldn't find an easy way to get the whitespace-trimmed text content of HTML elements; there was a &lt;code>Text&lt;/code> function, but
that contained everything. It seems it's not just the way of thinking of the Go language that makes me want more, but
also some Go modules. So I ended up writing a recursive function to trim whitespace using &lt;code>strings.TrimSpace&lt;/code> and join texts.&lt;/p>
&lt;p>This is how I would do it in Raku, using &lt;a href="https://github.com/zostay/raku-DOM-Tiny">DOM::Tiny&lt;/a> (also containing the previous code):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-raku" data-lang="raku">&lt;span style="color:#ef8383">put&lt;/span> &lt;span style="color:#dcaeea">$dom&lt;/span>&lt;span style="color:#c7bf54">.&lt;/span>&lt;span style="color:#ef8383">find&lt;/span>(&amp;#39;&lt;span style="color:#98c379">.my-element &amp;gt; div&lt;/span>&amp;#39;)&lt;span style="color:#c7bf54">.&lt;/span>&lt;span style="color:#ef8383">map&lt;/span>(&lt;span style="color:#c7bf54">*.&lt;/span>&lt;span style="color:#00b1f7">all-text&lt;/span>(:&lt;span style="color:#98c379">trim&lt;/span>))&lt;span style="color:#c7bf54">.&lt;/span>&lt;span style="color:#ef8383">join&lt;/span>(&amp;#34;&lt;span style="color:#d26464;font-weight:bold">\n&lt;/span>&amp;#34;)&lt;span style="color:#c7bf54">.&lt;/span>&lt;span style="color:#ef8383">trans&lt;/span>&lt;span style="color:#c7bf54">:&lt;/span> &amp;#39;&lt;span style="color:#98c379">0&lt;/span>&amp;#39;&lt;span style="color:#c7bf54">..&lt;/span>&amp;#39;&lt;span style="color:#98c379">9&lt;/span>&amp;#39; &lt;span style="color:#c7bf54">=&amp;gt;&lt;/span> &amp;#39;&lt;span style="color:#98c379">Û°&lt;/span>&amp;#39;&lt;span style="color:#c7bf54">..&lt;/span>&amp;#39;&lt;span style="color:#98c379">Û¹&lt;/span>&amp;#39;;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>And this is my Go solution(maybe there are better ways to do it, that I'm not aware of, or even better way to write my code):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8a93a5;font-style:italic">// ........
&lt;/span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c1abea">text&lt;/span> &lt;span style="color:#c7bf54">:=&lt;/span> &lt;span style="color:#c1abea">strings&lt;/span>.&lt;span style="color:#00b1f7">Join&lt;/span>(&lt;span style="color:#c1abea">doc&lt;/span>.&lt;span style="color:#00b1f7">Find&lt;/span>(&lt;span style="color:#98c379">`.my-element &amp;gt; div`&lt;/span>).&lt;span style="color:#00b1f7">Map&lt;/span>(&lt;span style="color:#c1abea">getText&lt;/span>), &lt;span style="color:#98c379">&amp;#34;\n&amp;#34;&lt;/span>)
&lt;span style="color:#c1abea">text&lt;/span> = &lt;span style="color:#c1abea">strings&lt;/span>.&lt;span style="color:#00b1f7">NewReplacer&lt;/span>(&lt;span style="color:#98c379">`0`&lt;/span>, &lt;span style="color:#98c379">`Û°`&lt;/span>, &lt;span style="color:#98c379">`1`&lt;/span>, &lt;span style="color:#98c379">`Û±`&lt;/span>, &lt;span style="color:#98c379">`2`&lt;/span>, &lt;span style="color:#98c379">`Û²`&lt;/span>, &lt;span style="color:#98c379">`3`&lt;/span>, &lt;span style="color:#98c379">`Û³`&lt;/span>, &lt;span style="color:#98c379">`4`&lt;/span>, &lt;span style="color:#98c379">`Û´`&lt;/span>, &lt;span style="color:#98c379">`5`&lt;/span>, &lt;span style="color:#98c379">`Ûµ`&lt;/span>, &lt;span style="color:#98c379">`6`&lt;/span>, &lt;span style="color:#98c379">`Û¶`&lt;/span>, &lt;span style="color:#98c379">`7`&lt;/span>, &lt;span style="color:#98c379">`Û·`&lt;/span>, &lt;span style="color:#98c379">`8`&lt;/span>, &lt;span style="color:#98c379">`Û¸`&lt;/span>, &lt;span style="color:#98c379">`9`&lt;/span>, &lt;span style="color:#98c379">`Û¹`&lt;/span>).&lt;span style="color:#00b1f7">Replace&lt;/span>(&lt;span style="color:#c1abea">text&lt;/span>)
&lt;span style="color:#c1abea">fmt&lt;/span>.&lt;span style="color:#00b1f7">Println&lt;/span>(&lt;span style="color:#c1abea">text&lt;/span>)
&lt;span style="color:#8a93a5;font-style:italic">// ........
&lt;/span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span>
&lt;span style="color:#c678dd">func&lt;/span> &lt;span style="color:#00b1f7">getText&lt;/span> (&lt;span style="color:#c1abea">_&lt;/span> &lt;span style="color:#ef8383">int&lt;/span>, &lt;span style="color:#c1abea">s&lt;/span> &lt;span style="color:#c7bf54">*&lt;/span>&lt;span style="color:#c1abea">goquery&lt;/span>.&lt;span style="color:#c1abea">Selection&lt;/span>) &lt;span style="color:#ef8383">string&lt;/span> {
&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#c1abea">children&lt;/span> &lt;span style="color:#c7bf54">:=&lt;/span> &lt;span style="color:#c1abea">s&lt;/span>.&lt;span style="color:#00b1f7">ChildrenFiltered&lt;/span>(&lt;span style="color:#98c379">`:not(img)`&lt;/span>); &lt;span style="color:#c1abea">children&lt;/span>.&lt;span style="color:#00b1f7">Text&lt;/span>() &lt;span style="color:#c7bf54">!=&lt;/span> &lt;span style="color:#98c379">``&lt;/span> {
&lt;span style="color:#c678dd">return&lt;/span> &lt;span style="color:#c1abea">strings&lt;/span>.&lt;span style="color:#00b1f7">Join&lt;/span>(&lt;span style="color:#c1abea">children&lt;/span>.&lt;span style="color:#00b1f7">Map&lt;/span>(&lt;span style="color:#c1abea">getText&lt;/span>), &lt;span style="color:#98c379">` `&lt;/span>)
} &lt;span style="color:#c678dd">else&lt;/span> {
&lt;span style="color:#c678dd">return&lt;/span> &lt;span style="color:#c1abea">strings&lt;/span>.&lt;span style="color:#00b1f7">TrimSpace&lt;/span>(&lt;span style="color:#c1abea">s&lt;/span>.&lt;span style="color:#00b1f7">Text&lt;/span>())
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Another solution is using the &lt;code>regexp&lt;/code> module to replace all whitespace:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#8a93a5;font-style:italic">// ........
&lt;/span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c1abea">text&lt;/span> &lt;span style="color:#c7bf54">:=&lt;/span> &lt;span style="color:#c1abea">strings&lt;/span>.&lt;span style="color:#00b1f7">Join&lt;/span>(&lt;span style="color:#c1abea">doc&lt;/span>.&lt;span style="color:#00b1f7">Find&lt;/span>(&lt;span style="color:#98c379">`.my-element &amp;gt; div`&lt;/span>).&lt;span style="color:#00b1f7">Map&lt;/span>(&lt;span style="color:#c678dd">func&lt;/span>(&lt;span style="color:#c1abea">_&lt;/span> &lt;span style="color:#ef8383">int&lt;/span>, &lt;span style="color:#c1abea">s&lt;/span> &lt;span style="color:#c7bf54">*&lt;/span>&lt;span style="color:#c1abea">goquery&lt;/span>.&lt;span style="color:#c1abea">Selection&lt;/span>) &lt;span style="color:#ef8383">string&lt;/span> {
&lt;span style="color:#c1abea">re&lt;/span> &lt;span style="color:#c7bf54">:=&lt;/span> &lt;span style="color:#c1abea">regexp&lt;/span>.&lt;span style="color:#00b1f7">MustCompile&lt;/span>(&lt;span style="color:#98c379">`\s+`&lt;/span>)
&lt;span style="color:#c678dd">return&lt;/span> &lt;span style="color:#c1abea">re&lt;/span>.&lt;span style="color:#00b1f7">ReplaceAllLiteralString&lt;/span>(&lt;span style="color:#c1abea">s&lt;/span>.&lt;span style="color:#00b1f7">Text&lt;/span>(), &lt;span style="color:#98c379">` `&lt;/span>)
}), &lt;span style="color:#98c379">&amp;#34;\n&amp;#34;&lt;/span>)
&lt;span style="color:#c1abea">text&lt;/span> = &lt;span style="color:#c1abea">strings&lt;/span>.&lt;span style="color:#00b1f7">NewReplacer&lt;/span>(&lt;span style="color:#98c379">`0`&lt;/span>, &lt;span style="color:#98c379">`Û°`&lt;/span>, &lt;span style="color:#98c379">`1`&lt;/span>, &lt;span style="color:#98c379">`Û±`&lt;/span>, &lt;span style="color:#98c379">`2`&lt;/span>, &lt;span style="color:#98c379">`Û²`&lt;/span>, &lt;span style="color:#98c379">`3`&lt;/span>, &lt;span style="color:#98c379">`Û³`&lt;/span>, &lt;span style="color:#98c379">`4`&lt;/span>, &lt;span style="color:#98c379">`Û´`&lt;/span>, &lt;span style="color:#98c379">`5`&lt;/span>, &lt;span style="color:#98c379">`Ûµ`&lt;/span>, &lt;span style="color:#98c379">`6`&lt;/span>, &lt;span style="color:#98c379">`Û¶`&lt;/span>, &lt;span style="color:#98c379">`7`&lt;/span>, &lt;span style="color:#98c379">`Û·`&lt;/span>, &lt;span style="color:#98c379">`8`&lt;/span>, &lt;span style="color:#98c379">`Û¸`&lt;/span>, &lt;span style="color:#98c379">`9`&lt;/span>, &lt;span style="color:#98c379">`Û¹`&lt;/span>).&lt;span style="color:#00b1f7">Replace&lt;/span>(&lt;span style="color:#c1abea">text&lt;/span>)
&lt;span style="color:#c1abea">fmt&lt;/span>.&lt;span style="color:#00b1f7">Println&lt;/span>(&lt;span style="color:#c1abea">text&lt;/span>)
&lt;span style="color:#8a93a5;font-style:italic">// ........
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What I get from Go is speed, so I won't complain too much ðŸ˜€&lt;/p>
&lt;p>And just for fun, I'm still seeing this when I visit &lt;a href="https://pkg.go.dev">https://pkg.go.dev&lt;/a> :
&lt;a href="https://www.ciavash.name/img/pkg.go.dev-blocked-for-Iran-by-Google.png">
&lt;img
src="https://www.ciavash.name/img/pkg.go.dev-blocked-for-Iran-by-Google.png"
alt="pkg.go.dev blocked for Iran by Google"
/>
&lt;/a>&lt;/p></description></item></channel></rss>